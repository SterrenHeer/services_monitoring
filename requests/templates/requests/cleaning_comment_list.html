{% extends 'base.html' %}

{% load custom_filters %}

{% block title %}
    Замечания по уборке
{% endblock %}

{% block content %}
    <div class="container">
        <div class="row">
            {% if cleaning_schedule %}
            {% regroup cleaning_schedule by building as building_list %}
            <div class="d-flex flex-column col-lg-7">
                {% for building in building_list %}
                <div class="d-flex flex-column my-2">
                    {% regroup building.list by date as date_list %}
                    {% for date in date_list %}
                    <div class="d-flex flex-row">
                        <div class="card-footer d-flex flex-column justify-content-center col-lg-2">
                            <h6 class="text-primary mb-0">{{ date.grouper|date:"j E" }}</h6>
                        </div>
                        <div class="card-footer d-flex flex-column flex-grow-1 col-lg-10">
                            {% for item in date.list %}
                            <div class="card-footer d-flex flex-lg-row flex-column flex-grow-1">
                                <h6 class="mb-0 col-lg-2 me-2">{{ item.start_time }}-{{ item.get_end_time }}</h6>
                                <h6 class="mb-0 col-lg-7 me-2">{{ item.service }}</h6>
                                {% if item.status == 'Запланирована' and item.get_overdue %}
                                    <h6 class="mb-0 col-lg-3 text-danger">{{ item.status }}</h6>
                                {% elif item.status == 'Выполнена' %}
                                    <h6 class="mb-0 col-lg-3 text-success">{{ item.status }}</h6>
                                {% else %}
                                    <h6 class="mb-0 col-lg-3">{{ item.status }}</h6>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endfor %}
            </div>
            <div class="d-flex flex-column col-lg-5">
                {% if comment_list %}
                {% for comment in comment_list %}
                    <div class="card my-2{% if request.user.tenant == comment.tenant %} border border-primary{% endif %}">
                        <div class="card-footer d-flex justify-content-between">
                            <h6 class="text-primary mb-0">{{ comment.text }}</h6>
                        </div>
                        <div class="card-footer d-flex justify-content-between">
                            <h6 class="mb-0">{{ comment.service }}</h6>
                            <h6 class="mb-0">{{ comment.status }}</h6>
                            {% if comment.completion_date and comment.status == 'Выполнена' %}
                                <h6 class="text-success font-italic mb-0">{{ comment.completion_date }}</h6>
                            {% else %}
                                <h6 class="mb-0">{{ comment.submission_date }}</h6>
                            {% endif %}
                            {% if comment.status == 'На рассмотрении' %}
                                <a href="{% url 'comment_delete' comment.id %}?cleaning=true"><i class="material-icons md-24">delete</i></a>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
                {% else %}
                <p class="text-center">Не было подано ни одного замечания.</p>
                {% endif %}
                <a class="btn btn-outline-primary mt-2" href="{% url 'comment_create' %}?cleaning=true">Добавить новое замечание</a>
            </div>
            {% else %}
            <p class="text-center">В графике уборки нет ни одной записи.</p>
            {% endif %}
        </div>
    </div>
{% endblock %}
